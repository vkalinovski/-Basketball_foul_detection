---
<div align="center">
  <img src="images/image.png" alt="Pipeline Overview" width="700" />
</div>

# üèÄ Basketball-Foul-Detection

---

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–Ω–≤–µ–π–µ—Ä –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ñ–æ–ª–æ–≤ –≤ –±–∞—Å–∫–µ—Ç–±–æ–ª—å–Ω—ã—Ö –º–∞—Ç—á–∞—Ö.  
–ì–ª–∞–≤–Ω–∞—è –º–æ–¥–µ–ª—å ‚Äî **RF-DETR**; **Faster R-CNN** –∏ **YOLOv12** —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–ª–∏—Å—å –∫–∞–∫ –±–∞–∑–æ–≤—ã–µ, –Ω–æ –ø–æ–∫–∞–∑–∞–ª–∏ —Ö—É–¥—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∑–¥–µ—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª–Ω–æ—Ç—ã.

<p align="center">
  <img src="https://img.shields.io/badge/PyTorch-2.2-blue?logo=pytorch" />
  <img src="https://img.shields.io/badge/Lightning-2.2.1-blueviolet?logo=lightning" />
  <img src="https://img.shields.io/badge/License-MIT-green" />
</p>

---

## üìö –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è)
2. [–î–∞—Ç–∞—Å–µ—Ç—ã](#-–¥–∞—Ç–∞—Å–µ—Ç—ã)
3. [–ö–æ–Ω–≤–µ–π–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏](#-–∫–æ–Ω–≤–µ–π–µ—Ä-–≤–∞–ª–∏–¥–∞—Ü–∏–∏)
4. [üìÅ Model Training](#-model-training)
5. [üìÅ Model Tuning](#-model-tuning)
6. [üìÅ Model Validation](#-model-validation)


---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```text
üì¶ project-root
‚îú‚îÄ‚îÄ Faster R-CNN/        # —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å Faster R-CNN
‚îú‚îÄ‚îÄ RF_DETR/             # –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å –∏ —Å–∫—Ä–∏–ø—Ç—ã –∏–Ω—Ñ–µ—Ä–µ–Ω—Å–∞
‚îú‚îÄ‚îÄ YOLOv12/             # —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã —Å YOLOv12
‚îú‚îÄ‚îÄ data_collection/     # —Å–±–æ—Ä –æ—á–∏—â–µ–Ω–Ω—ã—Ö –≤–∏–¥–µ–æ
‚îú‚îÄ‚îÄ dataset/
‚îÇ   ‚îî‚îÄ‚îÄ main/            # train / valid / test —Ñ—Ä–µ–π–º—ã
‚îú‚îÄ‚îÄ ref_validation/      # LLM + RF-DETR —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ weights/             # —á–µ–∫–ø–æ–∏–Ω—Ç—ã –º–æ–¥–µ–ª–µ–π
‚îî‚îÄ‚îÄ README.md            # –≤—ã —á–∏—Ç–∞–µ—Ç–µ –µ–≥–æ üòä
```
 
---

## üìä –î–∞—Ç–∞—Å–µ—Ç—ã

| –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –§–æ—Ä–º–∞—Ç | –†–∞–∑–º–µ—Ä | –°—Å—ã–ª–∫–∞ |
|------------|--------|--------|--------|
| –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–∞–¥—Ä–æ–≤ | `.jpg` / `.json` | 9 162 –∫–∞–¥—Ä–æ–≤ | **Kaggle:** [nba-foul-detection] |
| –ö–æ—Ä–æ—Ç–∫–∏–µ –≤–∏–¥–µ–æ-–∏–Ω—Ç–µ—Ä–≤–∞–ª—ã | `.mp4` | 3 h | *–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏* |
| –ù–µ–∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ full-game –≤–∏–¥–µ–æ | `.mkv` / `.mp4` | 25 GB | Google Drive (–¥–æ—Å—Ç—É–ø –ø–æ –∑–∞–ø—Ä–æ—Å—É) |

[nba-foul-detection]: https://www.kaggle.com/datasets/vladimirkalinovski/nba-foul-detection

---

## üîÑ –ö–æ–Ω–≤–µ–π–µ—Ä –≤–∞–ª–∏–¥–∞—Ü–∏–∏

> –ü–æ–ª–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ **LLM** –∏ **RF-DETR** –Ω–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –≤–∏–¥–µ–æ-—Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ö.

1. **–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ** ‚Üí –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ (OpenCV / FFmpeg).  
2. **ASR** ‚Üí Whisper –≤—ã–¥–∞—ë—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç —Å —Ç–∞–π–º-—Å—Ç–µ–º–ø–∞–º–∏.  
3. **LLM** ‚Üí prompt ‚ü∂ *`foul`* / *`no_foul`* + `confidence`.  
4. **RF-DETR** ‚Üí –∫–∞–¥—Ä-–∑–∞-–∫–∞–¥—Ä–æ–º –¥–µ—Ç–µ–∫—Ü–∏—è + —ç–≤—Ä–∏—Å—Ç–∏–∫–∞ —Ñ–æ–ª–∞ ‚Üí –≤–µ—Ä–¥–∏–∫—Ç.  
5. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ** ‚Üí Accuracy, Precision, Recall, F1, Agreement Rate.  

<details>
<summary>–ú–µ—Ç—Ä–∏–∫–∏</summary>

| –ú–µ—Ç—Ä–∏–∫–∞        | –§–æ—Ä–º—É–ª–∞                                          |
|----------------|--------------------------------------------------|
| Accuracy       | (TP + TN) / (P + N)                              |
| Precision      | TP / (TP + FP)                                   |
| Recall         | TP / (TP + FN)                                   |
| F1-score       | 2 ¬∑ (P ¬∑ R)/(P + R)                              |
| Agreement Rate | (# —Å–æ–≤–ø–∞–≤—à–∏—Ö –≤–µ—Ä–¥–∏–∫—Ç–æ–≤) / (# –≤—Å–µ—Ö —Å–ª—É—á–∞–µ–≤)       |

**TP** ‚Äì –æ–±–∞ —Å–∫–∞–∑–∞–ª–∏ *foul* –∏ —ç—Ç–æ –ø—Ä–∞–≤–¥–∞, **TN** ‚Äì –æ–±–∞ *no_foul*, **FP** ‚Äì –ª–æ–∂–Ω—ã–π —Ñ–æ–ª, **FN** ‚Äì –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã–π —Ñ–æ–ª.
</details>

---

## üìÅ Model Training

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | **SlowFast R50** –∏–∑ *PyTorchVideo* |
| –§—Ä–µ–π–º–≤–æ—Ä–∫ | **PyTorch Lightning** + AMP |
| –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ | –≤—Ä–µ–º. —Å—ç–º–ø–ª–∏–Ω–≥ ¬∑ crop ¬∑ flip ¬∑ jitter ¬∑ Gaussian&nbsp;noise |
| –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ | **Mixup**, label smoothing, **OneCycleLR** |
| –ñ—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ | Google Colab GPU ‚Üí —á–µ–∫–ø–æ–∏–Ω—Ç—ã + TensorBoard –≤ Google Drive |

–ù–æ—É—Ç–±—É–∫: [`RF_DETR/rf-detr-train.ipynb`](./RF_DETR/rf-detr-train.ipynb)

---

## üìÅ Model Tuning

- **Optuna** –ø–æ–¥–±–∏—Ä–∞–µ—Ç learning-rate, dropout, weight-decay –∏ –¥—Ä.  
- **Early Stopping** –∏ checkpointing –ø–æ –ª—É—á—à–µ–π val-accuracy.  
- `seen_videos.txt` –∏—Å–∫–ª—é—á–∞–µ—Ç —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∏–ø—ã ‚Üí –±–µ–∑ data leakage.  
- **Gradient Clipping** + —á–∞—Å—Ç–∏—á–Ω–æ–µ ¬´–∑–∞–º–æ—Ä–æ–∑–∫–∞¬ª backbone –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.

---

## üìÅ Model Validation

| –≠—Ç–∞–ø | –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç |
|------|-----------|
| ‚öôÔ∏è –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –º–æ–¥–µ–ª–∏ | `RF_DETR/video_annotation.ipynb` |
| üìñ –ò–Ω—Ñ–µ—Ä–µ–Ω—Å LLM | `ref_validation/ref_validation.ipynb` |
| üèÅ –ü–æ–¥—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫ | `ref_validation/ref_validation.ipynb` (—Ä–∞–∑–¥–µ–ª *Evaluation*) |

–í—ã–≤–æ–¥ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ `ref_validation/results.csv`.

---

## üóÉÔ∏è –ë–∞–∑–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (Faster R-CNN & YOLOv12)

| –ú–æ–¥–µ–ª—å | –ù–æ—É—Ç–±—É–∫ | mAP@0.5 | –ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–∫–∞–∑–∞ |
|--------|---------|--------|----------------|
| Faster R-CNN | [`Faster R-CNN/r_cnn.ipynb`](./Faster%20R-CNN/r_cnn.ipynb) | 0.1 | –º–µ–¥–ª–µ–Ω–Ω–æ, –ø–µ—Ä–µ–æ–±—É—á–∞–µ—Ç—Å—è |
| YOLOv12 | [`YOLOv12/train-yolo12.ipynb`](./YOLOv12/train-yolo12.ipynb) | 0.48 | —Ö—É–∂–µ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç—ã |

---

## üöÄ –ó–∞–ø—É—Å–∫

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
conda env create -f environment.yml
conda activate foul-detect

# 2. –°–∫–∞—á–∞–π—Ç–µ –≤–µ—Å–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —á–µ–∫–ø–æ–∏–Ω—Ç–∞
bash scripts/download_weights.sh  # (~250 MB)

# 3. –ò–Ω—Ñ–µ—Ä–µ–Ω—Å –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ
python infer.py --video path/to/clip.mp4 --out results.json

